{% extends 'base.html' %}

{% block title %}{% if centro %}Editar{% else %}Crear{% endif %} Centro de Costo - ZivaBSuite{% endblock %}

{% block content %}
<div class="py-6">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:p-6">
                <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:text-3xl mb-6">
                    <i class="fas fa-sitemap text-indigo-600 mr-3"></i>
                    {% if centro %}Editar Centro de Costo{% else %}Nuevo Centro de Costo{% endif %}
                </h2>

                <form method="post">
                    {% csrf_token %}
                    <div class="space-y-6">
                        <!-- Información Básica -->
                        <div>
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Información Básica</h3>
                            <div class="mt-4 grid grid-cols-1 gap-y-6 sm:grid-cols-2 sm:gap-x-4">
                                <div>
                                    <label for="codigo" class="block text-sm font-medium text-gray-700">Código</label>
                                    <input type="text" name="codigo" id="codigo" value="{{ centro.codigo|default:'' }}" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="nombre" class="block text-sm font-medium text-gray-700">Nombre</label>
                                    <input type="text" name="nombre" id="nombre" value="{{ centro.nombre|default:'' }}" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                </div>
                                <div class="sm:col-span-2">
                                    <label for="descripcion" class="block text-sm font-medium text-gray-700">Descripción</label>
                                    <textarea name="descripcion" id="descripcion" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">{{ centro.descripcion|default:'' }}</textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Clasificación -->
                        <div>
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Clasificación</h3>
                            <div class="mt-4 grid grid-cols-1 gap-y-6 sm:grid-cols-2 sm:gap-x-4">
                                <div>
                                    <label for="tipo" class="block text-sm font-medium text-gray-700">Tipo</label>
                                    <select id="tipo" name="tipo" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                        <option value="">-- Seleccione un tipo --</option>
                                        {% for tipo_obj in tipos_disponibles %}
                                            <option value="{{ tipo_obj.id }}" 
                                                {% if centro and centro.tipo and centro.tipo.id == tipo_obj.id %}selected{% endif %}>
                                                {{ tipo_obj.codigo }} - {{ tipo_obj.nombre }}
                                            </option>
                                        {% empty %}
                                            <option value="" disabled>No hay tipos configurados</option>
                                        {% endfor %}
                                    </select>
                                    {% if not tipos_disponibles %}
                                    <p class="mt-1 text-sm text-amber-600">
                                        <i class="fas fa-exclamation-triangle mr-1"></i>
                                        No hay tipos de centro configurados. 
                                        <a href="{% url 'tipos-centro-list' %}" class="text-indigo-600 hover:text-indigo-900 underline">Crear tipos primero</a>
                                    </p>
                                    {% endif %}
                                </div>
                                <div>
                                    <label for="centro_padre" class="block text-sm font-medium text-gray-700">Centro Padre (Opcional)</label>
                                    <select id="centro_padre" name="centro_padre" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                        <option value="">-- Ninguno --</option>
                                        {% for c in centros_disponibles %}
                                            <option value="{{ c.id }}" {% if centro and centro.centro_padre and centro.centro_padre.id == c.id %}selected{% endif %}>
                                                {{ c.codigo }} - {{ c.nombre }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Configuración -->
                        <div>
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Configuración</h3>
                            <div class="mt-4 space-y-4">
                                <div class="flex items-start">
                                    <div class="flex h-5 items-center">
                                        <input id="permite_movimientos" name="permite_movimientos" type="checkbox" {% if centro.permite_movimientos|default:True %}checked{% endif %} class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="permite_movimientos" class="font-medium text-gray-700">Permite movimientos</label>
                                        <p class="text-gray-500">Si se desmarca, este centro solo servirá para agrupar otros centros.</p>
                                    </div>
                                </div>
                                <div>
                                    <label for="color_interfaz" class="block text-sm font-medium text-gray-700">Color en Interfaz</label>
                                    <select id="color_interfaz" name="color_interfaz" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                                        <option value="blue" {% if not centro or centro.color_interfaz == 'blue' %}selected{% endif %}>Azul</option>
                                        <option value="green" {% if centro and centro.color_interfaz == 'green' %}selected{% endif %}>Verde</option>
                                        <option value="purple" {% if centro and centro.color_interfaz == 'purple' %}selected{% endif %}>Morado</option>
                                        <option value="red" {% if centro and centro.color_interfaz == 'red' %}selected{% endif %}>Rojo</option>
                                        <option value="yellow" {% if centro and centro.color_interfaz == 'yellow' %}selected{% endif %}>Amarillo</option>
                                        <option value="indigo" {% if centro and centro.color_interfaz == 'indigo' %}selected{% endif %}>Índigo</option>
                                        <option value="pink" {% if centro and centro.color_interfaz == 'pink' %}selected{% endif %}>Rosa</option>
                                        <option value="gray" {% if centro and centro.color_interfaz == 'gray' %}selected{% endif %}>Gris</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Acciones -->
                    <div class="pt-8 flex justify-end space-x-3">
                        <a href="{% url 'centros-costo-list' %}" class="rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50">Cancelar</a>
                        <button type="submit" class="inline-flex justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
